<div class="new-book-wrapper">
  <div class="container">
    <div class="row">
      <div class="new-book-container">
        
        <h1>Search Books</h1>
        
        <div class="form-group">
          <label for="title">書籍のタイトルを入力してください</label>
          <input type="text" class="form-control" id="title" placeholder="書籍のタイトル">
        </div>
        
      
        <%= form_for @book do |f| %>
          
          <div class="search-result">
            <p class="search-title">書籍タイトル：</p>
            <p id="booktitle"0></p>
            <%= f.hidden_field :title, class: 'js-title' %>
          </div>
          
          <div class="search-result">
            <p class="search-title">著者：</p>
            <p id="bookauthor"></p>
            <%= f.hidden_field :author, class: 'js-author' %>
          </div>
          
          <div class="search-result">
            <p class="search-title">出版日：</p>
            <p id="publisheddate"></p>
            <%= f.hidden_field :published, class: 'js-published' %>
          </div>
          
          <div class="search-result">
            <p class="search-title">書籍サムネイル：</p>
            <p id="bookthumbnail"></p>
            <%= f.hidden_field :thumbnail, class: 'js-thumbnail' %>
          </div>
          
          <div class="search-result">
            <p class="search-title">書籍概要：</p>
            <p id="bookdescription"></p>
            <%= f.hidden_field :description, class: 'js-description' %>
          </div>
          
          
          <%= f.submit "My Books", class: 'btn-block btn-black' %>
          
        <% end %>
        
        <%= form_for @topic, url: new_topic_path, method: :get do |f| %>
          
          
          <%= f.hidden_field :title, class: 'js-title' %>
          
          <%= f.hidden_field :author, class: 'js-author' %>
          
          
          <%= f.hidden_field :published, class: 'js-published' %>
          
          
          <%= f.hidden_field :thumbnail, class: 'js-thumbnail' %>
          
          
          <%= f.hidden_field :description, class: 'js-description' %>
          
          
          <%= f.submit "書籍を紹介", class: 'btn-block btn-black' %>
          
          
        <% end %>
        
        
        
      </div>
    </div>
  </div>
</div>


<script>
  $('#title').change(function(){
    const intitle =$('#title').val();
    const url = 'https://www.googleapis.com/books/v1/volumes?q=intitle:' + intitle;
    
    $.getJSON(url, function(data){
      
      if(!data.totalItems) {
        $('#title').val('');
        
        $('#booktitle').text('');
        
        $('#bookauthor').text('');
        
        $('#publisheddate').text('');
        
        $('#bookthumbnail').text('');
        
        $('#bookdescription').text('');
        
      }else {
        
          $('#booktitle').text(data.items[0].volumeInfo.title);
          $('.js-title').val(data.items[0].volumeInfo.title);
          
          $('#bookauthor').text(data.items[0].volumeInfo.authors);
          $('.js-author').val(data.items[0].volumeInfo.authors);
          
          $('#publisheddate').text(data.items[0].volumeInfo.publishedDate);
          $('.js-published').val(data.items[0].volumeInfo.publishedDate);
          
          $('#bookthumbnail').html('<img src=\"' + data.items[0].volumeInfo.imageLinks.smallThumbnail + '\" />');
          $('.js-thumbnail').val(data.items[0].volumeInfo.imageLinks.smallThumbnail);
          
          $('#bookdescription').text(data.items[0].volumeInfo.description);
          $('.js-description').val(data.items[0].volumeInfo.description);
          
        //for (var i = 0; i < data.items.length; i++) {
          //$('#booktitle').text(data.items[i].volumeInfo.title);
          //$('.js-title').val(data.items[i].volumeInfo.title);
          
          //$('#bookauthor').text(data.items[i].volumeInfo.authors);
          //$('.js-author').val(data.items[i].volumeInfo.authors);
          
          //$('#publisheddate').text(data.items[i].volumeInfo.publishedDate);
          //$('.js-published').val(data.items[i].volumeInfo.publishedDate);
          
          //$('#bookthumbnail').html('<img src=\"' + data.items[i].volumeInfo.imageLinks.smallThumbnail + '\" />');
          //$('.js-thumbnail').val(data.items[i].volumeInfo.imageLinks.smallThumbnail);
          
          //$('#bookdescription').text(data.items[i].volumeInfo.description);
          //$('.js-description').val(data.items[i].volumeInfo.description);
          
        //}
        
        
      }
      
    });
    
  });
</script>
